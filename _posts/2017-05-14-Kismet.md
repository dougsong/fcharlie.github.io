---
layout: post
title:  "Kismet 杂谈"
date:   2017-05-14 10:00:00
published: true
categories: developer
---

# 前言

年初以来，互联网安全领域频繁发生大事件，年初，Google 研究人员攻破了 SHA-1算法，在版本控制领域，主要的版本控制系统都使用了 SHA-1 算法<sup>1</sup>，由于工作需要，所以我对此也格外关注，也了解了其他 SHA 算法，比如 SHA-256/SHA-512 基于 Keccak 的 SHA-3 等，后来发现大多数 GUI Hash/MD5 工具都未提供 SHA-3 算法支持，并且界面也不符合我的口味，在闲暇时间，我就开发了 kismat Hash 计算工具，包括传统的Win32 桌面程序和 UWP 程序。

## SHA-3

在 SHA-1 被攻破的好几年前，NIST 就已经 SHA-3 算法的征集，经过几年测试，2012 年 Keccak 被选为优胜者，成为了 SHA-3。

**Keccak** 官方网站：[http://keccak.noekeon.org/](http://keccak.noekeon.org/) 在这里，你可以下载提交给 NIST 的原始版本。
在 [Keccak Code Package](https://github.com/gvanas/KeccakCodePackage)<sup>2</sup> 项目中你可以下载 SHA-3 以及各种变种。

Github 上 C/C++ 的 SHA-3 实现非常多，但是基础平台都未实现，如 Windows CNG, Apple Security.framework,OpenSSL。在 Windows 中，依然可以使用 Windows CNG ,截至到 10.0.15063, CNG 依然没有支持 SHA-3，同样的，虽然 OpenSSL 添加了 `keccak1600.c` 但是其 SHA-3 依然未完全实现。

ARM mbed 的 `mbedtls`<sup>3</sup> Google 的 `Boringssl`<sup>4</sup> OpenBSD 的 `LibreSSL`<sup>5</sup> 也未支持 SHA-3。


下面是 `bcrypt.h` 关于加密算法的定义：

```c++
#define BCRYPT_RSA_ALGORITHM                    L"RSA"
#define BCRYPT_RSA_SIGN_ALGORITHM               L"RSA_SIGN"
#define BCRYPT_DH_ALGORITHM                     L"DH"
#define BCRYPT_DSA_ALGORITHM                    L"DSA"
#define BCRYPT_RC2_ALGORITHM                    L"RC2"
#define BCRYPT_RC4_ALGORITHM                    L"RC4"
#define BCRYPT_AES_ALGORITHM                    L"AES"
#define BCRYPT_DES_ALGORITHM                    L"DES"
#define BCRYPT_DESX_ALGORITHM                   L"DESX"
#define BCRYPT_3DES_ALGORITHM                   L"3DES"
#define BCRYPT_3DES_112_ALGORITHM               L"3DES_112"
#define BCRYPT_MD2_ALGORITHM                    L"MD2"
#define BCRYPT_MD4_ALGORITHM                    L"MD4"
#define BCRYPT_MD5_ALGORITHM                    L"MD5"
#define BCRYPT_SHA1_ALGORITHM                   L"SHA1"
#define BCRYPT_SHA256_ALGORITHM                 L"SHA256"
#define BCRYPT_SHA384_ALGORITHM                 L"SHA384"
#define BCRYPT_SHA512_ALGORITHM                 L"SHA512"
#define BCRYPT_AES_GMAC_ALGORITHM               L"AES-GMAC"
#define BCRYPT_AES_CMAC_ALGORITHM               L"AES-CMAC"
#define BCRYPT_ECDSA_P256_ALGORITHM             L"ECDSA_P256"
#define BCRYPT_ECDSA_P384_ALGORITHM             L"ECDSA_P384"
#define BCRYPT_ECDSA_P521_ALGORITHM             L"ECDSA_P521"
#define BCRYPT_ECDH_P256_ALGORITHM              L"ECDH_P256"
#define BCRYPT_ECDH_P384_ALGORITHM              L"ECDH_P384"
#define BCRYPT_ECDH_P521_ALGORITHM              L"ECDH_P521"
#define BCRYPT_RNG_ALGORITHM                    L"RNG"
#define BCRYPT_RNG_FIPS186_DSA_ALGORITHM        L"FIPS186DSARNG"
#define BCRYPT_RNG_DUAL_EC_ALGORITHM            L"DUALECRNG"

#if (NTDDI_VERSION >= NTDDI_WIN8)
#define BCRYPT_SP800108_CTR_HMAC_ALGORITHM      L"SP800_108_CTR_HMAC"
#define BCRYPT_SP80056A_CONCAT_ALGORITHM        L"SP800_56A_CONCAT"
#define BCRYPT_PBKDF2_ALGORITHM                 L"PBKDF2"
#define BCRYPT_CAPI_KDF_ALGORITHM               L"CAPI_KDF"
#define BCRYPT_TLS1_1_KDF_ALGORITHM             L"TLS1_1_KDF"
#define BCRYPT_TLS1_2_KDF_ALGORITHM             L"TLS1_2_KDF"
#endif

#if (NTDDI_VERSION >= NTDDI_WINTHRESHOLD)
#define BCRYPT_ECDSA_ALGORITHM                  L"ECDSA"
#define BCRYPT_ECDH_ALGORITHM                   L"ECDH"
#define BCRYPT_XTS_AES_ALGORITHM                L"XTS-AES"
#endif
```

如果开发者需要支持 SHA-3 ，又要考虑提供库的稳定性，可以选择 [RHash](https://github.com/rhash/RHash) , CMake 3.8 开始使用 RHash 支持 SHA-3 [Utilities/cmlibrhash](https://gitlab.kitware.com/cmake/cmake/tree/master/Utilities/cmlibrhash)。在其他语言中，大多是第三方人员实现的 SHA-3，标准库或者平台 API 并未实现（这些语言标准库可能使用 Windows CNG 或者 OpenSSL 的加密算法实现）。

## Kismet

Kismet 是一个传统的 Win32 程序，使用 ATL 封装窗口，Direct2D 绘制界面，Hash 库使用的正是 RHash，RHash 支持 MD4,MD5,SHA-1,SHA-224/256,SHA-384/512,SHA-3 (224,256,384,512) ,能够很大程度的避免引入多个依赖库。

Kismet 使用 RHash 的代码在： [Hashusm.cpp](https://github.com/fcharlie/Kismet/blob/master/Kismet/Hashsum.cpp)

![none](https://github.com/fcharlie/Kismet/raw/master/docs/images/none.png)

![title](https://github.com/fcharlie/Kismet/raw/master/docs/images/title.png)

![coll](https://github.com/fcharlie/Kismet/raw/master/docs/images/coll.png)

![progress](https://github.com/fcharlie/Kismet/raw/master/docs/images/progress.png)

![complete](https://github.com/fcharlie/Kismet/raw/master/docs/images/complete.png)

![sha3-512](https://github.com/fcharlie/Kismet/raw/master/docs/images/sha3-512.png)

![theme](https://github.com/fcharlie/Kismet/raw/master/docs/images/theme.png)

## Kismet UWP

![u1](https://github.com/fcharlie/KismetUWP/raw/master/docs/images/none.png)

![u2](https://github.com/fcharlie/KismetUWP/raw/master/docs/images/hash.png)



## 附录

1. Git 将对象类型（blob,tree,commit）与长度以及文件内容连接在一起做 SHA-1 计算。Subversion 的 SHA-1 冲突要严重多了。
2. KCP KeccakCodePackage [(https://github.com/gvanas/KeccakCodePackage) ]((https://github.com/gvanas/KeccakCodePackage) )
3. Mbedtls [https://github.com/ARMmbed/mbedtls](https://github.com/ARMmbed/mbedtls)
4. BoringSSL [https://github.com/google/boringssl](https://github.com/google/boringssl)
5. LibreSSL [http://www.libressl.org/](http://www.libressl.org/)